<UserControl x:Class="NexusFinance.Views.LiquidityView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="#050505">

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="40">
        <StackPanel>
            
            <!-- HEADER -->
            <Grid Margin="0,0,0,30">
                <TextBlock Text="ðŸ’§ Liquidity Manager" 
                          FontSize="32" 
                          FontWeight="Bold" 
                          Foreground="#E0E0E0"/>
                <Button Content="ðŸ”„ Refresh" 
                       Command="{Binding RefreshCommand}"
                       HorizontalAlignment="Right"
                       Foreground="Black"
                       BorderBrush="#808080"
                       BorderThickness="1"
                       Padding="15,8"
                       FontSize="12"
                       FontWeight="Bold"
                       Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background">
                                <Setter.Value>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                        <GradientStop Color="#E0E0E0" Offset="0"/>
                                        <GradientStop Color="#C0C0C0" Offset="1"/>
                                    </LinearGradientBrush>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                               BorderBrush="{TemplateBinding BorderBrush}"
                                               BorderThickness="{TemplateBinding BorderThickness}"
                                               CornerRadius="6" 
                                               Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>

            <!-- FORECAST BAR - GLASS -->
            <Border Background="#CC252526" 
                   CornerRadius="12" 
                   Padding="30" 
                   Margin="0,0,0,30"
                   BorderBrush="#505050" 
                   BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect Color="Black" ShadowDepth="4" BlurRadius="10" Opacity="0.5"/>
                </Border.Effect>
                
                <StackPanel>
                    <TextBlock Text="ðŸ“ˆ Liquidity Forecast" 
                              FontSize="20" 
                              FontWeight="SemiBold" 
                              Foreground="#E0E0E0" 
                              Margin="0,0,0,20"/>
                    
                    <!-- FORECAST FORMULA -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- CURRENT CASH -->
                        <StackPanel Grid.Column="0" Margin="0,0,20,0">
                            <TextBlock Text="Current Cash" FontSize="12" Foreground="#808080"/>
                            <TextBlock Text="{Binding CurrentCash, StringFormat='â‚½{0:N0}'}" 
                                      FontSize="24" 
                                      FontWeight="Bold" 
                                      Foreground="#C0C0C0"/>
                        </StackPanel>
                        
                        <TextBlock Grid.Column="1" Text="+" FontSize="32" Foreground="#606060" Margin="10,15,10,0"/>
                        
                        <!-- RECEIVABLES -->
                        <StackPanel Grid.Column="2" Margin="0,0,20,0">
                            <TextBlock Text="+ Pending Receivables" FontSize="12" Foreground="#808080"/>
                            <TextBlock Text="{Binding TotalReceivables, StringFormat='â‚½{0:N0}'}" 
                                      FontSize="24" 
                                      FontWeight="Bold" 
                                      Foreground="#00C853"/>
                        </StackPanel>
                        
                        <TextBlock Grid.Column="3" Text="âˆ’" FontSize="32" Foreground="#606060" Margin="10,15,10,0"/>
                        
                        <!-- PAYABLES -->
                        <StackPanel Grid.Column="4" Margin="0,0,20,0">
                            <TextBlock Text="âˆ’ Pending Payables" FontSize="12" Foreground="#808080"/>
                            <TextBlock Text="{Binding TotalPayables, StringFormat='â‚½{0:N0}'}" 
                                      FontSize="24" 
                                      FontWeight="Bold" 
                                      Foreground="#D50000"/>
                        </StackPanel>
                        
                        <TextBlock Grid.Column="5" Text="=" FontSize="32" Foreground="#606060" Margin="10,15,10,0"/>
                        
                        <!-- PROJECTED BALANCE -->
                        <Border Grid.Column="6" 
                               Background="#CC1E1E1E" 
                               CornerRadius="8" 
                               Padding="20,10"
                               BorderBrush="{Binding ProjectedBalanceColor}"
                               BorderThickness="2"
                               Margin="10,0,0,0">
                            <StackPanel>
                                <TextBlock Text="Projected Balance" FontSize="12" Foreground="#808080"/>
                                <TextBlock Text="{Binding ProjectedBalance, StringFormat='â‚½{0:N0}'}" 
                                          FontSize="32" 
                                          FontWeight="Bold" 
                                          Foreground="{Binding ProjectedBalanceColor}"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                    
                    <!-- ALERTS -->
                    <Grid Margin="0,20,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <Border Grid.Column="0" 
                               Background="#CC2A1212" 
                               CornerRadius="6" 
                               Padding="15"
                               Margin="0,0,10,0"
                               BorderBrush="#D50000"
                               BorderThickness="1">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="âš ï¸" FontSize="20" Margin="0,0,10,0"/>
                                <StackPanel>
                                    <TextBlock Text="{Binding OverduePayablesCount, StringFormat='{}{0} Overdue'}" 
                                              FontSize="16" 
                                              FontWeight="Bold" 
                                              Foreground="#FF5252"/>
                                    <TextBlock Text="{Binding CriticalPayablesCount, StringFormat='{}{0} Critical/High'}" 
                                              FontSize="12" 
                                              Foreground="#909090"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- SPLIT VIEW: PAYABLES & RECEIVABLES -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- LEFT: PAYABLES (I OWE) -->
                <Border Grid.Column="0" 
                       Background="#CC252526" 
                       CornerRadius="12" 
                       Padding="20"
                       BorderBrush="#505050" 
                       BorderThickness="1">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" ShadowDepth="4" BlurRadius="10" Opacity="0.5"/>
                    </Border.Effect>
                    
                    <StackPanel>
                        <Grid Margin="0,0,0,20">
                            <TextBlock Text="âš ï¸ OBLIGATIONS (I Owe)" 
                                      FontSize="20" 
                                      FontWeight="SemiBold" 
                                      Foreground="#E0E0E0"
                                      VerticalAlignment="Center"/>
                            <Button Content="âž• Add" 
                                   Command="{Binding AddPayableCommand}"
                                   HorizontalAlignment="Right"
                                   Foreground="Black"
                                   BorderBrush="#808080"
                                   BorderThickness="1"
                                   Padding="12,6"
                                   FontSize="11"
                                   FontWeight="Bold"
                                   Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                    <GradientStop Color="#E0E0E0" Offset="0"/>
                                                    <GradientStop Color="#C0C0C0" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Setter.Value>
                                        </Setter>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" 
                                                           BorderBrush="{TemplateBinding BorderBrush}"
                                                           BorderThickness="{TemplateBinding BorderThickness}"
                                                           CornerRadius="4" 
                                                           Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                        
                        <ItemsControl ItemsSource="{Binding Payables}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#1E1E1E" 
                                           CornerRadius="8" 
                                           Padding="15" 
                                           Margin="0,0,0,12"
                                           BorderBrush="{Binding UrgencyColor}"
                                           BorderThickness="2">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- HEADER -->
                                            <Grid Grid.Row="0">
                                                <StackPanel>
                                                    <TextBlock Text="{Binding Title}" 
                                                              FontSize="16" 
                                                              FontWeight="SemiBold" 
                                                              Foreground="White"/>
                                                    <TextBlock Text="{Binding CreditorName}" 
                                                              FontSize="12" 
                                                              Foreground="#909090" 
                                                              Margin="0,3,0,0"/>
                                                </StackPanel>
                                                
                                                <Border Background="{Binding UrgencyColor}" 
                                                       CornerRadius="4" 
                                                       Padding="8,4"
                                                       HorizontalAlignment="Right"
                                                       VerticalAlignment="Top">
                                                    <TextBlock Text="{Binding UrgencyLevel}" 
                                                              FontSize="10" 
                                                              FontWeight="Bold" 
                                                              Foreground="Black"/>
                                                </Border>
                                            </Grid>
                                            
                                            <!-- AMOUNT & DUE DATE -->
                                            <Grid Grid.Row="1" Margin="0,10,0,0">
                                                <TextBlock Text="{Binding Amount, StringFormat='â‚½{0:N0}'}" 
                                                          FontSize="24" 
                                                          FontWeight="Bold" 
                                                          Foreground="#FF5252"/>
                                                <StackPanel HorizontalAlignment="Right">
                                                    <TextBlock Text="{Binding DueDateDisplay}" 
                                                              FontSize="12" 
                                                              Foreground="#808080"
                                                              TextAlignment="Right"/>
                                                    <TextBlock Text="{Binding DaysUntilDueText}" 
                                                              FontSize="11" 
                                                              Foreground="#606060"
                                                              TextAlignment="Right"
                                                              Margin="0,2,0,0"/>
                                                </StackPanel>
                                            </Grid>
                                            
                                            <!-- ACTIONS -->
                                            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                                <Button Content="âœ… Mark Paid" 
                                                       Command="{Binding DataContext.MarkPayableAsPaidCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                       CommandParameter="{Binding Id}"
                                                       Background="#CC00C853"
                                                       Foreground="Black"
                                                       BorderThickness="0"
                                                       FontSize="10"
                                                       Padding="8,4"
                                                       Margin="0,0,5,0"
                                                       Cursor="Hand"/>
                                                <Button Content="âœï¸" 
                                                       Command="{Binding DataContext.EditPayableCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                       CommandParameter="{Binding Id}"
                                                       Background="Transparent"
                                                       Foreground="#AAAAAA"
                                                       BorderThickness="0"
                                                       FontSize="12"
                                                       Padding="6"
                                                       Cursor="Hand"/>
                                                <Button Content="ðŸ—‘ï¸" 
                                                       Command="{Binding DataContext.DeletePayableCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                       CommandParameter="{Binding Id}"
                                                       Background="Transparent"
                                                       Foreground="#D50000"
                                                       BorderThickness="0"
                                                       FontSize="12"
                                                       Padding="6"
                                                       Cursor="Hand"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
                
                <!-- RIGHT: RECEIVABLES (OWED TO ME) -->
                <Border Grid.Column="2" 
                       Background="#CC252526" 
                       CornerRadius="12" 
                       Padding="20"
                       BorderBrush="#505050" 
                       BorderThickness="1">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" ShadowDepth="4" BlurRadius="10" Opacity="0.5"/>
                    </Border.Effect>
                    
                    <StackPanel>
                        <Grid Margin="0,0,0,20">
                            <TextBlock Text="ðŸ’° RECEIVABLES (Owed to Me)" 
                                      FontSize="20" 
                                      FontWeight="SemiBold" 
                                      Foreground="#E0E0E0"
                                      VerticalAlignment="Center"/>
                            <Button Content="âž• Add" 
                                   Command="{Binding AddReceivableCommand}"
                                   HorizontalAlignment="Right"
                                   Foreground="Black"
                                   BorderBrush="#808080"
                                   BorderThickness="1"
                                   Padding="12,6"
                                   FontSize="11"
                                   FontWeight="Bold"
                                   Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                    <GradientStop Color="#E0E0E0" Offset="0"/>
                                                    <GradientStop Color="#C0C0C0" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Setter.Value>
                                        </Setter>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" 
                                                           BorderBrush="{TemplateBinding BorderBrush}"
                                                           BorderThickness="{TemplateBinding BorderThickness}"
                                                           CornerRadius="4" 
                                                           Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                        
                        <ItemsControl ItemsSource="{Binding Receivables}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#1E1E1E" 
                                           CornerRadius="8" 
                                           Padding="15" 
                                           Margin="0,0,0,12"
                                           BorderBrush="{Binding ProbabilityColor}"
                                           BorderThickness="2">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- HEADER -->
                                            <Grid Grid.Row="0">
                                                <StackPanel>
                                                    <TextBlock Text="{Binding Title}" 
                                                              FontSize="16" 
                                                              FontWeight="SemiBold" 
                                                              Foreground="White"/>
                                                    <TextBlock Text="{Binding DebtorName}" 
                                                              FontSize="12" 
                                                              Foreground="#909090" 
                                                              Margin="0,3,0,0"/>
                                                </StackPanel>
                                                
                                                <Border Background="{Binding ProbabilityColor}" 
                                                       CornerRadius="4" 
                                                       Padding="8,4"
                                                       HorizontalAlignment="Right"
                                                       VerticalAlignment="Top">
                                                    <TextBlock Text="{Binding ProbabilityText}" 
                                                              FontSize="10" 
                                                              FontWeight="Bold" 
                                                              Foreground="Black"/>
                                                </Border>
                                            </Grid>
                                            
                                            <!-- AMOUNT & EXPECTED DATE -->
                                            <Grid Grid.Row="1" Margin="0,10,0,0">
                                                <StackPanel>
                                                    <TextBlock Text="{Binding Amount, StringFormat='â‚½{0:N0}'}" 
                                                              FontSize="24" 
                                                              FontWeight="Bold" 
                                                              Foreground="#00C853"/>
                                                    <TextBlock Text="{Binding ConfidenceDisplay}" 
                                                              FontSize="10" 
                                                              Foreground="#606060"
                                                              Margin="0,2,0,0"/>
                                                </StackPanel>
                                                
                                                <StackPanel HorizontalAlignment="Right">
                                                    <TextBlock Text="Expected:" 
                                                              FontSize="10" 
                                                              Foreground="#606060"
                                                              TextAlignment="Right"/>
                                                    <TextBlock Text="{Binding ExpectedDateDisplay}" 
                                                              FontSize="12" 
                                                              Foreground="#808080"
                                                              TextAlignment="Right"
                                                              Margin="0,2,0,0"/>
                                                </StackPanel>
                                            </Grid>
                                            
                                            <!-- ACTIONS -->
                                            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                                <Button Content="âœ… Mark Received" 
                                                       Command="{Binding DataContext.MarkReceivableAsReceivedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                       CommandParameter="{Binding Id}"
                                                       Background="#CC00C853"
                                                       Foreground="Black"
                                                       BorderThickness="0"
                                                       FontSize="10"
                                                       Padding="8,4"
                                                       Margin="0,0,5,0"
                                                       Cursor="Hand"/>
                                                <Button Content="âœï¸" 
                                                       Command="{Binding DataContext.EditReceivableCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                       CommandParameter="{Binding Id}"
                                                       Background="Transparent"
                                                       Foreground="#AAAAAA"
                                                       BorderThickness="0"
                                                       FontSize="12"
                                                       Padding="6"
                                                       Cursor="Hand"/>
                                                <Button Content="ðŸ—‘ï¸" 
                                                       Command="{Binding DataContext.DeleteReceivableCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                       CommandParameter="{Binding Id}"
                                                       Background="Transparent"
                                                       Foreground="#D50000"
                                                       BorderThickness="0"
                                                       FontSize="12"
                                                       Padding="6"
                                                       Cursor="Hand"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </Grid>

        </StackPanel>
    </ScrollViewer>
</UserControl>
